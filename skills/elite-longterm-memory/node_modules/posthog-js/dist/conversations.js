!function(){"use strict";function e(e,t,i,n,r,o,s){try{var a=e[o](s),l=a.value}catch(e){return void i(e)}a.done?t(l):Promise.resolve(l).then(n,r)}function t(t){return function(){var i=this,n=arguments;return new Promise((function(r,o){var s=t.apply(i,n);function a(t){e(s,r,o,a,l,"next",t)}function l(t){e(s,r,o,a,l,"throw",t)}a(void 0)}))}}function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)({}).hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},i.apply(null,arguments)}var n,r,o,s,a,l,u,d,c,h,f,p={},v=[],g=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,m=Array.isArray;function y(e,t){for(var i in t)e[i]=t[i];return e}function w(e){e&&e.parentNode&&e.parentNode.removeChild(e)}function b(e,t,i,n,s){var a={type:e,props:t,key:i,ref:n,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:null==s?++o:s,__i:-1,__u:0};return null==s&&null!=r.vnode&&r.vnode(a),a}function x(e){return e.children}function _(e,t){this.props=e,this.context=t}function k(e,t){if(null==t)return e.__?k(e.__,e.__i+1):null;for(var i;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e)return i.__e;return"function"==typeof e.type?k(e):null}function C(e){var t,i;if(null!=(e=e.__)&&null!=e.__c){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if(null!=(i=e.__k[t])&&null!=i.__e){e.__e=e.__c.base=i.__e;break}return C(e)}}function I(e){(!e.__d&&(e.__d=!0)&&s.push(e)&&!$.__r++||a!=r.debounceRendering)&&((a=r.debounceRendering)||l)($)}function $(){for(var e,t,i,n,o,a,l,d=1;s.length;)s.length>d&&s.sort(u),e=s.shift(),d=s.length,e.__d&&(i=void 0,n=void 0,o=(n=(t=e).__v).__e,a=[],l=[],t.__P&&((i=y({},n)).__v=n.__v+1,r.vnode&&r.vnode(i),A(t.__P,i,n,t.__n,t.__P.namespaceURI,32&n.__u?[o]:null,a,null==o?k(n):o,!!(32&n.__u),l),i.__v=n.__v,i.__.__k[i.__i]=i,W(a,i,l),n.__e=n.__=null,i.__e!=o&&C(i)));$.__r=0}function S(e,t,i,n,r,o,s,a,l,u,d){var c,h,f,g,m,y,w,b=n&&n.__k||v,x=t.length;for(l=M(i,t,b,l,x),c=0;c<x;c++)null!=(f=i.__k[c])&&(h=-1==f.__i?p:b[f.__i]||p,f.__i=c,y=A(e,f,h,r,o,s,a,l,u,d),g=f.__e,f.ref&&h.ref!=f.ref&&(h.ref&&R(h.ref,null,f),d.push(f.ref,f.__c||g,f)),null==m&&null!=g&&(m=g),(w=!!(4&f.__u))||h.__k===f.__k?l=E(f,l,e,w):"function"==typeof f.type&&void 0!==y?l=y:g&&(l=g.nextSibling),f.__u&=-7);return i.__e=m,l}function M(e,t,i,n,r){var o,s,a,l,u,d=i.length,c=d,h=0;for(e.__k=new Array(r),o=0;o<r;o++)null!=(s=t[o])&&"boolean"!=typeof s&&"function"!=typeof s?("string"==typeof s||"number"==typeof s||"bigint"==typeof s||s.constructor==String?s=e.__k[o]=b(null,s,null,null,null):m(s)?s=e.__k[o]=b(x,{children:s},null,null,null):void 0===s.constructor&&s.__b>0?s=e.__k[o]=b(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):e.__k[o]=s,l=o+h,s.__=e,s.__b=e.__b+1,a=null,-1!=(u=s.__i=T(s,i,l,c))&&(c--,(a=i[u])&&(a.__u|=2)),null==a||null==a.__v?(-1==u&&(r>d?h--:r<d&&h++),"function"!=typeof s.type&&(s.__u|=4)):u!=l&&(u==l-1?h--:u==l+1?h++:(u>l?h--:h++,s.__u|=4))):e.__k[o]=null;if(c)for(o=0;o<d;o++)null!=(a=i[o])&&0==(2&a.__u)&&(a.__e==n&&(n=k(a)),U(a,a));return n}function E(e,t,i,n){var r,o;if("function"==typeof e.type){for(r=e.__k,o=0;r&&o<r.length;o++)r[o]&&(r[o].__=e,t=E(r[o],t,i,n));return t}e.__e!=t&&(n&&(t&&e.type&&!t.parentNode&&(t=k(e)),i.insertBefore(e.__e,t||null)),t=e.__e);do{t=t&&t.nextSibling}while(null!=t&&8==t.nodeType);return t}function T(e,t,i,n){var r,o,s,a=e.key,l=e.type,u=t[i],d=null!=u&&0==(2&u.__u);if(null===u&&null==a||d&&a==u.key&&l==u.type)return i;if(n>(d?1:0))for(r=i-1,o=i+1;r>=0||o<t.length;)if(null!=(u=t[s=r>=0?r--:o++])&&0==(2&u.__u)&&a==u.key&&l==u.type)return s;return-1}function F(e,t,i){"-"==t[0]?e.setProperty(t,null==i?"":i):e[t]=null==i?"":"number"!=typeof i||g.test(t)?i:i+"px"}function D(e,t,i,n,r){var o,s;e:if("style"==t)if("string"==typeof i)e.style.cssText=i;else{if("string"==typeof n&&(e.style.cssText=n=""),n)for(t in n)i&&t in i||F(e.style,t,"");if(i)for(t in i)n&&i[t]==n[t]||F(e.style,t,i[t])}else if("o"==t[0]&&"n"==t[1])o=t!=(t=t.replace(d,"$1")),s=t.toLowerCase(),t=s in e||"onFocusOut"==t||"onFocusIn"==t?s.slice(2):t.slice(2),e.l||(e.l={}),e.l[t+o]=i,i?n?i.u=n.u:(i.u=c,e.addEventListener(t,o?f:h,o)):e.removeEventListener(t,o?f:h,o);else{if("http://www.w3.org/2000/svg"==r)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if("width"!=t&&"height"!=t&&"href"!=t&&"list"!=t&&"form"!=t&&"tabIndex"!=t&&"download"!=t&&"rowSpan"!=t&&"colSpan"!=t&&"role"!=t&&"popover"!=t&&t in e)try{e[t]=null==i?"":i;break e}catch(e){}"function"==typeof i||(null==i||!1===i&&"-"!=t[4]?e.removeAttribute(t):e.setAttribute(t,"popover"==t&&1==i?"":i))}}function L(e){return function(t){if(this.l){var i=this.l[t.type+e];if(null==t.t)t.t=c++;else if(t.t<i.u)return;return i(r.event?r.event(t):t)}}}function A(e,t,i,n,o,s,a,l,u,d){var c,h,f,p,v,g,b,k,C,I,M,$,E,T,F,D,L,A=t.type;if(void 0!==t.constructor)return null;128&i.__u&&(u=!!(32&i.__u),s=[l=t.__e=i.__e]),(c=r.__b)&&c(t);e:if("function"==typeof A)try{if(k=t.props,C="prototype"in A&&A.prototype.render,I=(c=A.contextType)&&n[c.__c],M=c?I?I.props.value:c.__:n,i.__c?b=(h=t.__c=i.__c).__=h.__E:(C?t.__c=h=new A(k,M):(t.__c=h=new _(k,M),h.constructor=A,h.render=B),I&&I.sub(h),h.state||(h.state={}),h.__n=n,f=h.__d=!0,h.__h=[],h._sb=[]),C&&null==h.__s&&(h.__s=h.state),C&&null!=A.getDerivedStateFromProps&&(h.__s==h.state&&(h.__s=y({},h.__s)),y(h.__s,A.getDerivedStateFromProps(k,h.__s))),p=h.props,v=h.state,h.__v=t,f)C&&null==A.getDerivedStateFromProps&&null!=h.componentWillMount&&h.componentWillMount(),C&&null!=h.componentDidMount&&h.__h.push(h.componentDidMount);else{if(C&&null==A.getDerivedStateFromProps&&k!==p&&null!=h.componentWillReceiveProps&&h.componentWillReceiveProps(k,M),t.__v==i.__v||!h.__e&&null!=h.shouldComponentUpdate&&!1===h.shouldComponentUpdate(k,h.__s,M)){for(t.__v!=i.__v&&(h.props=k,h.state=h.__s,h.__d=!1),t.__e=i.__e,t.__k=i.__k,t.__k.some((function(e){e&&(e.__=t)})),$=0;$<h._sb.length;$++)h.__h.push(h._sb[$]);h._sb=[],h.__h.length&&a.push(h);break e}null!=h.componentWillUpdate&&h.componentWillUpdate(k,h.__s,M),C&&null!=h.componentDidUpdate&&h.__h.push((function(){h.componentDidUpdate(p,v,g)}))}if(h.context=M,h.props=k,h.__P=e,h.__e=!1,E=r.__r,T=0,C){for(h.state=h.__s,h.__d=!1,E&&E(t),c=h.render(h.props,h.state,h.context),F=0;F<h._sb.length;F++)h.__h.push(h._sb[F]);h._sb=[]}else do{h.__d=!1,E&&E(t),c=h.render(h.props,h.state,h.context),h.state=h.__s}while(h.__d&&++T<25);h.state=h.__s,null!=h.getChildContext&&(n=y(y({},n),h.getChildContext())),C&&!f&&null!=h.getSnapshotBeforeUpdate&&(g=h.getSnapshotBeforeUpdate(p,v)),D=c,null!=c&&c.type===x&&null==c.key&&(D=z(c.props.children)),l=S(e,m(D)?D:[D],t,i,n,o,s,a,l,u,d),h.base=t.__e,t.__u&=-161,h.__h.length&&a.push(h),b&&(h.__E=h.__=null)}catch(e){if(t.__v=null,u||null!=s)if(e.then){for(t.__u|=u?160:128;l&&8==l.nodeType&&l.nextSibling;)l=l.nextSibling;s[s.indexOf(l)]=null,t.__e=l}else{for(L=s.length;L--;)w(s[L]);P(t)}else t.__e=i.__e,t.__k=i.__k,e.then||P(t);r.__e(e,t,i)}else null==s&&t.__v==i.__v?(t.__k=i.__k,t.__e=i.__e):l=t.__e=N(i.__e,t,i,n,o,s,a,u,d);return(c=r.diffed)&&c(t),128&t.__u?void 0:l}function P(e){e&&e.__c&&(e.__c.__e=!0),e&&e.__k&&e.__k.forEach(P)}function W(e,t,i){for(var n=0;n<i.length;n++)R(i[n],i[++n],i[++n]);r.__c&&r.__c(t,e),e.some((function(t){try{e=t.__h,t.__h=[],e.some((function(e){e.call(t)}))}catch(e){r.__e(e,t.__v)}}))}function z(e){return"object"!=typeof e||null==e||e.__b&&e.__b>0?e:m(e)?e.map(z):y({},e)}function N(e,t,i,o,s,a,l,u,d){var c,h,f,v,g,y,b,x=i.props||p,_=t.props,C=t.type;if("svg"==C?s="http://www.w3.org/2000/svg":"math"==C?s="http://www.w3.org/1998/Math/MathML":s||(s="http://www.w3.org/1999/xhtml"),null!=a)for(c=0;c<a.length;c++)if((g=a[c])&&"setAttribute"in g==!!C&&(C?g.localName==C:3==g.nodeType)){e=g,a[c]=null;break}if(null==e){if(null==C)return document.createTextNode(_);e=document.createElementNS(s,C,_.is&&_),u&&(r.__m&&r.__m(t,a),u=!1),a=null}if(null==C)x===_||u&&e.data==_||(e.data=_);else{if(a=a&&n.call(e.childNodes),!u&&null!=a)for(x={},c=0;c<e.attributes.length;c++)x[(g=e.attributes[c]).name]=g.value;for(c in x)if(g=x[c],"children"==c);else if("dangerouslySetInnerHTML"==c)f=g;else if(!(c in _)){if("value"==c&&"defaultValue"in _||"checked"==c&&"defaultChecked"in _)continue;D(e,c,null,g,s)}for(c in _)g=_[c],"children"==c?v=g:"dangerouslySetInnerHTML"==c?h=g:"value"==c?y=g:"checked"==c?b=g:u&&"function"!=typeof g||x[c]===g||D(e,c,g,x[c],s);if(h)u||f&&(h.__html==f.__html||h.__html==e.innerHTML)||(e.innerHTML=h.__html),t.__k=[];else if(f&&(e.innerHTML=""),S("template"==t.type?e.content:e,m(v)?v:[v],t,i,o,"foreignObject"==C?"http://www.w3.org/1999/xhtml":s,a,l,a?a[0]:i.__k&&k(i,0),u,d),null!=a)for(c=a.length;c--;)w(a[c]);u||(c="value","progress"==C&&null==y?e.removeAttribute("value"):null!=y&&(y!==e[c]||"progress"==C&&!y||"option"==C&&y!=x[c])&&D(e,c,y,x[c],s),c="checked",null!=b&&b!=e[c]&&D(e,c,b,x[c],s))}return e}function R(e,t,i){try{if("function"==typeof e){var n="function"==typeof e.__u;n&&e.__u(),n&&null==t||(e.__u=e(t))}else e.current=t}catch(e){r.__e(e,i)}}function U(e,t,i){var n,o;if(r.unmount&&r.unmount(e),(n=e.ref)&&(n.current&&n.current!=e.__e||R(n,null,t)),null!=(n=e.__c)){if(n.componentWillUnmount)try{n.componentWillUnmount()}catch(e){r.__e(e,t)}n.base=n.__P=null}if(n=e.__k)for(o=0;o<n.length;o++)n[o]&&U(n[o],t,i||"function"!=typeof e.type);i||w(e.__e),e.__c=e.__=e.__e=void 0}function B(e,t,i){return this.constructor(e,i)}function O(e,t,i){var o,s,a;t==document&&(t=document.documentElement),r.__&&r.__(e,t),o=!1?null:t.__k,s=[],a=[],A(t,e=t.__k=function(e,t,i){var r,o,s,a={};for(s in t)"key"==s?r=t[s]:"ref"==s?o=t[s]:a[s]=t[s];if(arguments.length>2&&(a.children=arguments.length>3?n.call(arguments,2):i),"function"==typeof e&&null!=e.defaultProps)for(s in e.defaultProps)void 0===a[s]&&(a[s]=e.defaultProps[s]);return b(e,a,r,o,null)}(x,null,[e]),o||p,p,t.namespaceURI,o?null:t.firstChild?n.call(t.childNodes):null,s,o?o.__e:t.firstChild,false,a),W(s,e,a)}n=v.slice,r={__e:function(e,t,i,n){for(var r,o,s;t=t.__;)if((r=t.__c)&&!r.__)try{if((o=r.constructor)&&null!=o.getDerivedStateFromError&&(r.setState(o.getDerivedStateFromError(e)),s=r.__d),null!=r.componentDidCatch&&(r.componentDidCatch(e,n||{}),s=r.__d),s)return r.__E=r}catch(t){e=t}throw e}},o=0,_.prototype.setState=function(e,t){var i;i=null!=this.__s&&this.__s!=this.state?this.__s:this.__s=y({},this.state),"function"==typeof e&&(e=e(y({},i),this.props)),e&&y(i,e),null!=e&&this.__v&&(t&&this._sb.push(t),I(this))},_.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),I(this))},_.prototype.render=x,s=[],l="function"==typeof Promise?Promise.prototype.then.bind(Promise.resolve()):setTimeout,u=function(e,t){return e.__v.__b-t.__v.__b},$.__r=0,d=/(PointerCapture)$|Capture$/i,c=0,h=L(!1),f=L(!0);var j=Array.isArray,H=Object.prototype,V=H.hasOwnProperty,q=H.toString,Y=j||function(e){return"[object Array]"===q.call(e)},G=e=>void 0===e,X=e=>"[object Number]"==q.call(e)&&e==e,K="undefined"!=typeof window?window:void 0,Z="undefined"!=typeof globalThis?globalThis:K;"undefined"==typeof self&&(Z.self=Z),"undefined"==typeof File&&(Z.File=function(){});var J=Array.prototype.forEach,Q=null==Z?void 0:Z.navigator,ee=null==Z?void 0:Z.document;null==Z||Z.location,null==Z||Z.fetch,null!=Z&&Z.XMLHttpRequest&&"withCredentials"in new Z.XMLHttpRequest&&Z.XMLHttpRequest,null==Z||Z.AbortController,null==Q||Q.userAgent;var te=null!=K?K:{},ie=function(e,t){var{debugEnabled:i}=void 0===t?{}:t,n={i:function(t){if(K&&(te.POSTHOG_DEBUG||i)&&!G(K.console)&&K.console){for(var n=("__rrweb_original__"in K.console[t]?K.console[t].__rrweb_original__:K.console[t]),r=arguments.length,o=new Array(r>1?r-1:0),s=1;s<r;s++)o[s-1]=arguments[s];n(e,...o)}},info:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.i("log",...t)},warn:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.i("warn",...t)},error:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];n.i("error",...t)},critical:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];console.error(e,...i)},uninitializedWarning:e=>{n.error("You must initialize PostHog before calling "+e)},createLogger:(t,i)=>ie(e+" "+t,i)};return n},ne=ie("[PostHog.js]").createLogger;Math.trunc||(Math.trunc=function(e){return e<0?Math.ceil(e):Math.floor(e)}),Number.isInteger||(Number.isInteger=function(e){return X(e)&&isFinite(e)&&Math.floor(e)===e});var re="0123456789abcdef";class oe{constructor(e){if(this.bytes=e,16!==e.length)throw new TypeError("not 128-bit length")}static fromFieldsV7(e,t,i,n){if(!Number.isInteger(e)||!Number.isInteger(t)||!Number.isInteger(i)||!Number.isInteger(n)||e<0||t<0||i<0||n<0||e>0xffffffffffff||t>4095||i>1073741823||n>4294967295)throw new RangeError("invalid field value");var r=new Uint8Array(16);return r[0]=e/Math.pow(2,40),r[1]=e/Math.pow(2,32),r[2]=e/Math.pow(2,24),r[3]=e/Math.pow(2,16),r[4]=e/Math.pow(2,8),r[5]=e,r[6]=112|t>>>8,r[7]=t,r[8]=128|i>>>24,r[9]=i>>>16,r[10]=i>>>8,r[11]=i,r[12]=n>>>24,r[13]=n>>>16,r[14]=n>>>8,r[15]=n,new oe(r)}toString(){for(var e="",t=0;t<this.bytes.length;t++)e=e+re.charAt(this.bytes[t]>>>4)+re.charAt(15&this.bytes[t]),3!==t&&5!==t&&7!==t&&9!==t||(e+="-");if(36!==e.length)throw new Error("Invalid UUIDv7 was generated");return e}clone(){return new oe(this.bytes.slice(0))}equals(e){return 0===this.compareTo(e)}compareTo(e){for(var t=0;t<16;t++){var i=this.bytes[t]-e.bytes[t];if(0!==i)return Math.sign(i)}return 0}}class se{constructor(){this.o=0,this.h=0,this.p=new ue}generate(){var e=this.generateOrAbort();if(G(e)){this.o=0;var t=this.generateOrAbort();if(G(t))throw new Error("Could not generate UUID after timestamp reset");return t}return e}generateOrAbort(){var e=Date.now();if(e>this.o)this.o=e,this.v();else{if(!(e+1e4>this.o))return;this.h++,this.h>4398046511103&&(this.o++,this.v())}return oe.fromFieldsV7(this.o,Math.trunc(this.h/Math.pow(2,30)),this.h&Math.pow(2,30)-1,this.p.nextUint32())}v(){this.h=1024*this.p.nextUint32()+(1023&this.p.nextUint32())}}var ae,le=e=>{if("undefined"!=typeof UUIDV7_DENY_WEAK_RNG&&UUIDV7_DENY_WEAK_RNG)throw new Error("no cryptographically strong RNG available");for(var t=0;t<e.length;t++)e[t]=65536*Math.trunc(65536*Math.random())+Math.trunc(65536*Math.random());return e};K&&!G(K.crypto)&&crypto.getRandomValues&&(le=e=>crypto.getRandomValues(e));class ue{constructor(){this.m=new Uint32Array(8),this.k=1/0}nextUint32(){return this.k>=this.m.length&&(le(this.m),this.k=0),this.m[this.k++]}}var de=()=>ce().toString(),ce=()=>(ae||(ae=new se)).generate(),he=ne("[ConversationsPersistence]"),fe="$conversations_widget_session_id",pe="$conversations_ticket_id",ve="$conversations_widget_state",ge="$conversations_user_traits";class me{constructor(e){this.C=null,this._posthog=e}I(){var e,t;return!(!this._posthog.persistence||null!=(e=(t=this._posthog.persistence).isDisabled)&&e.call(t))}getOrCreateWidgetSessionId(){if(this.C)return this.C;if(!this.I()){var e=de();return he.warn("Persistence not available, widget_session_id will not persist",{sessionId:e}),e}try{var t,i,n=null==(t=this._posthog.persistence)?void 0:t.get_property(fe);if(!n)n=de(),null==(i=this._posthog.persistence)||i.register({[fe]:n});return this.C=n,n}catch(e){return he.error("Failed to get/create widget_session_id",e),de()}}clearWidgetSessionId(){if(this.C=null,this.I())try{var e;null==(e=this._posthog.persistence)||e.unregister(fe),he.info("Cleared widget_session_id")}catch(e){he.error("Failed to clear widget_session_id",e)}}saveTicketId(e){if(this.I())try{var t;null==(t=this._posthog.persistence)||t.register({[pe]:e}),he.info("Saved ticket ID",{ticketId:e})}catch(e){he.error("Failed to save ticket ID",e)}else he.warn("Persistence not available")}loadTicketId(){if(!this.I())return he.warn("Persistence not available"),null;try{var e,t=null==(e=this._posthog.persistence)?void 0:e.get_property(pe);return t&&he.info("Loaded ticket ID",{ticketId:t}),t||null}catch(e){return he.error("Failed to load ticket ID",e),null}}clearTicketId(){if(this.I())try{var e;null==(e=this._posthog.persistence)||e.unregister(pe),he.info("Cleared ticket ID")}catch(e){he.error("Failed to clear ticket ID",e)}else he.warn("Persistence not available")}saveWidgetState(e){if(this.I())try{var t;null==(t=this._posthog.persistence)||t.register({[ve]:e})}catch(e){he.error("Failed to save widget state",e)}}loadWidgetState(){if(!this.I())return null;try{var e,t=null==(e=this._posthog.persistence)?void 0:e.get_property(ve);return"open"===t||"closed"===t?t:null}catch(e){return he.error("Failed to load widget state",e),null}}saveUserTraits(e){if(this.I())try{var t;null==(t=this._posthog.persistence)||t.register({[ge]:e}),he.info("Saved user traits",{hasName:!!e.name,hasEmail:!!e.email})}catch(e){he.error("Failed to save user traits",e)}else he.warn("Persistence not available")}loadUserTraits(){if(!this.I())return null;try{var e,t=null==(e=this._posthog.persistence)?void 0:e.get_property(ge);return t?(he.info("Loaded user traits",{hasName:!!t.name,hasEmail:!!t.email}),t):null}catch(e){return he.error("Failed to load user traits",e),null}}clearUserTraits(){if(this.I())try{var e;null==(e=this._posthog.persistence)||e.unregister(ge),he.info("Cleared user traits")}catch(e){he.error("Failed to clear user traits",e)}}clearAll(){if(this.I())try{var e,t,i;null==(e=this._posthog.persistence)||e.unregister(ve),null==(t=this._posthog.persistence)||t.unregister(ge),null==(i=this._posthog.persistence)||i.unregister(pe),this.clearWidgetSessionId(),he.info("Cleared all conversation data")}catch(e){he.error("Failed to clear conversation data",e)}}}function ye(e){var t=e.replace(/^#/,""),i=3===t.length?t[0]+t[0]+t[1]+t[1]+t[2]+t[2]:t,n=parseInt(i.slice(0,2),16),r=parseInt(i.slice(2,4),16),o=parseInt(i.slice(4,6),16);return Math.sqrt(n*n*.299+r*r*.587+o*o*.114)>127.5?"#020617":"white"}var we=function(e,t){void 0===t&&(t="bottom_right");var n=t.includes("left"),r=t.includes("top");return{widget:i({position:"fixed"},r?{top:"20px"}:{bottom:"20px"},n?{left:"20px"}:{right:"20px"},{zIndex:2147483647,fontFamily:'-apple-system, BlinkMacSystemFont, "Inter", "Segoe UI", "Roboto", Helvetica, Arial, sans-serif'}),buttonContainer:{position:"relative"},button:{width:"50px",height:"50px",borderRadius:"50%",background:e,color:ye(e),border:"none",cursor:"pointer",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",transition:"transform 0.2s ease-out, box-shadow 0.2s ease-out"},unreadBadge:i({position:"absolute"},r?{bottom:"-4px"}:{top:"-4px"},n?{left:"-4px"}:{right:"-4px"},{minWidth:"20px",height:"20px",borderRadius:"10px",background:"#ef4444",color:"white",fontSize:"11px",fontWeight:600,display:"flex",alignItems:"center",justifyContent:"center",padding:"0 5px",boxShadow:"0 2px 4px rgba(0, 0, 0, 0.2)",border:"2px solid white",boxSizing:"border-box"}),window:i({position:"absolute"},r?{top:0}:{bottom:0},n?{left:0}:{right:0},{background:"white",borderRadius:"10px",boxShadow:"0 10px 25px -3px rgba(0,0,0,0.12), 0 4px 12px -2px rgba(0,0,0,0.10)",display:"flex",flexDirection:"column",overflow:"hidden",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",border:"none"}),windowOpen:{width:"400px",height:"600px",maxHeight:"calc(100vh - 100px)"},header:{background:e,color:ye(e),padding:"8px 12px",display:"flex",justifyContent:"space-between",alignItems:"center",flexShrink:0},headerTitle:{fontWeight:500,fontSize:"14px"},headerActions:{display:"flex",gap:"4px"},headerButton:{background:"transparent",border:"none",color:ye(e),cursor:"pointer",padding:"6px 8px",fontSize:"16px",lineHeight:1,borderRadius:"4px",transition:"background 0.2s ease-out",opacity:.9},messages:{flex:1,overflowY:"auto",padding:"14px",display:"flex",flexDirection:"column",gap:"8px",background:"white"},message:{display:"flex",flexDirection:"column",maxWidth:"85%",animation:"fadeIn 0.2s ease-out"},messageCustomer:{alignSelf:"flex-end",alignItems:"flex-end"},messageAgent:{alignSelf:"flex-start",alignItems:"flex-start"},messageAuthor:{fontSize:"10px",color:"#939393",marginBottom:"4px",fontWeight:500},messageContent:{padding:"8px 12px",borderRadius:"8px",fontSize:"12px",lineHeight:1.5,wordWrap:"break-word",whiteSpace:"pre-wrap"},messageContentCustomer:{background:e,color:ye(e),borderBottomRightRadius:"2px"},messageContentAgent:{background:"white",color:"#020617",border:"1.5px solid #dcdcdc",borderBottomLeftRadius:"2px"},messageTime:{fontSize:"10px",color:"#939393",marginTop:"4px",opacity:.8},error:{padding:"10px 16px",background:"#fee2e2",color:"#991b1b",fontSize:"13px",borderTop:"1px solid #fecaca",borderBottom:"1px solid #fecaca",textAlign:"center",fontWeight:500},inputContainer:{padding:"8px 12px",background:"white",borderTop:"1px solid #dcdcdc",display:"flex",gap:"8px",alignItems:"center",flexShrink:0},input:{flex:1,maxHeight:"120px",fontSize:"14px",resize:"vertical",fontFamily:"inherit",lineHeight:1.5,color:"#020617",background:"white",border:"none",outline:"none",transition:"border-color 0.2s ease-out, box-shadow 0.2s ease-out",display:"flex",alignItems:"center",fieldSizing:"content"},sendButton:{width:"33px",height:"33px",borderRadius:"10px",background:e,color:ye(e),border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease-out",boxShadow:"0 2px 0 rgba(0, 0, 0, 0.045)",fontWeight:700,flexShrink:0},identificationForm:{flex:1,display:"flex",flexDirection:"column",padding:"24px",background:"#eeeded",overflowY:"auto"},formTitle:{fontSize:"18px",fontWeight:600,color:"#020617",marginBottom:"8px"},formDescription:{fontSize:"14px",color:"#64748b",marginBottom:"24px",lineHeight:1.5},formField:{marginBottom:"16px"},formLabel:{display:"block",fontSize:"13px",fontWeight:500,color:"#020617",marginBottom:"6px"},formInput:{width:"100%",padding:"10px 12px",border:"1px solid #dcdcdc",borderRadius:"6px",fontSize:"14px",fontFamily:"inherit",color:"#020617",background:"white",transition:"border-color 0.2s ease-out, box-shadow 0.2s ease-out",boxSizing:"border-box"},formInputError:{borderColor:"#ef4444"},formError:{fontSize:"12px",color:"#ef4444",marginTop:"4px"},formSubmitButton:{width:"100%",padding:"12px 16px",borderRadius:"6px",background:e,color:ye(e),border:"none",cursor:"pointer",fontSize:"14px",fontWeight:600,transition:"all 0.2s ease-out",marginTop:"8px"},formOptional:{fontSize:"12px",color:"#939393",fontWeight:400}}},be=0;function xe(e,t,i,n,o,s){t||(t={});var a,l,u=t;if("ref"in u)for(l in u={},t)"ref"==l?a=t[l]:u[l]=t[l];var d={type:e,props:u,key:i,ref:a,__k:null,__:null,__b:0,__e:null,__c:null,constructor:void 0,__v:--be,__i:-1,__u:0,__source:o,__self:s};if("function"==typeof e&&(a=e.defaultProps))for(l in a)void 0===u[l]&&(u[l]=a[l]);return r.vnode&&r.vnode(d),d}var _e,ke,Ce,Ie,Se=e=>{var{primaryColor:t,position:i="bottom_right",handleToggleOpen:n,unreadCount:r=0}=e,o=we(t,i),s=r>99?"99+":r.toString();return xe("div",{style:o.widget,children:xe("div",{style:o.buttonContainer,children:[xe("button",{style:o.button,onClick:n,"aria-label":r>0?"Open chat ("+r+" unread)":"Open chat",onMouseEnter:e=>{e.currentTarget.style.transform="scale(1.05)",e.currentTarget.style.boxShadow="0 6px 20px rgba(0, 0, 0, 0.2)"},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.15)"},children:xe("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:xe("path",{d:"M12 2C6.48 2 2 6.48 2 12C2 13.93 2.6 15.71 3.64 17.18L2.5 21.5L7.04 20.42C8.46 21.28 10.17 21.75 12 21.75C17.52 21.75 22 17.27 22 11.75C22 6.23 17.52 2 12 2Z",fill:"currentColor"})})}),r>0&&xe("div",{style:o.unreadBadge,children:s})]})})},Me=e=>{var{primaryColor:t,inputValue:n,isLoading:r,handleSendMessage:o}=e;return xe("button",{style:i({},we(t).sendButton,{opacity:!n.trim()||r?.6:1,cursor:!n.trim()||r?"not-allowed":"pointer"}),onClick:o,disabled:!n.trim()||r,"aria-label":"Send message",onMouseEnter:e=>{e.currentTarget.disabled||(e.currentTarget.style.transform="scale(1.02)",e.currentTarget.style.boxShadow="0 4px 8px rgba(0, 0, 0, 0.1)")},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)",e.currentTarget.style.boxShadow="0 2px 0 rgba(0, 0, 0, 0.045)"},children:xe("svg",{width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:xe("path",{d:"M2 10L18 2L10 18L8 11L2 10Z",fill:"currentColor",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round"})})})},Ee=e=>{var{primaryColor:t,handleClose:i}=e;return xe("button",{style:we(t).headerButton,onClick:i,"aria-label":"Close",onMouseEnter:e=>{e.currentTarget.style.background="rgba(255, 255, 255, 0.15)",e.currentTarget.style.opacity="1"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.opacity="0.9"},children:"âœ•"})},Te=0,Fe=[],De=r,Le=De.__b,Ae=De.__r,Pe=De.diffed,We=De.__c,ze=De.unmount,Ne=De.__;function Re(e,t){De.__h&&De.__h(ke,e,Te||t),Te=0;var i=ke.__H||(ke.__H={__:[],__h:[]});return e>=i.__.length&&i.__.push({}),i.__[e]}function Ue(){for(var e;e=Fe.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(Oe),e.__H.__h.forEach(je),e.__H.__h=[]}catch(t){e.__H.__h=[],De.__e(t,e.__v)}}De.__b=function(e){ke=null,Le&&Le(e)},De.__=function(e,t){e&&t.__k&&t.__k.__m&&(e.__m=t.__k.__m),Ne&&Ne(e,t)},De.__r=function(e){Ae&&Ae(e),_e=0;var t=(ke=e.__c).__H;t&&(Ce===ke?(t.__h=[],ke.__h=[],t.__.forEach((function(e){e.__N&&(e.__=e.__N),e.u=e.__N=void 0}))):(t.__h.forEach(Oe),t.__h.forEach(je),t.__h=[],_e=0)),Ce=ke},De.diffed=function(e){Pe&&Pe(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(1!==Fe.push(t)&&Ie===De.requestAnimationFrame||((Ie=De.requestAnimationFrame)||$e)(Ue)),t.__H.__.forEach((function(e){e.u&&(e.__H=e.u),e.u=void 0}))),Ce=ke=null},De.__c=function(e,t){t.some((function(e){try{e.__h.forEach(Oe),e.__h=e.__h.filter((function(e){return!e.__||je(e)}))}catch(i){t.some((function(e){e.__h&&(e.__h=[])})),t=[],De.__e(i,e.__v)}})),We&&We(e,t)},De.unmount=function(e){ze&&ze(e);var t,i=e.__c;i&&i.__H&&(i.__H.__.forEach((function(e){try{Oe(e)}catch(e){t=e}})),i.__H=void 0,t&&De.__e(t,i.__v))};var Be="function"==typeof requestAnimationFrame;function $e(e){var t,i=function(){clearTimeout(n),Be&&cancelAnimationFrame(t),setTimeout(e)},n=setTimeout(i,35);Be&&(t=requestAnimationFrame(i))}function Oe(e){var t=ke,i=e.__c;"function"==typeof i&&(e.__c=void 0,i()),ke=t}function je(e){var t=ke;e.__c=e.__(),ke=t}function He(e){if(e&&"string"==typeof e){var t=e.replace(/[\x00-\x1f\x7f\u200b-\u200d\ufeff]/g,"").trim();if(t){var i=t.replace(/\s+/g,"").toLowerCase();if(!(i.startsWith("javascript:")||i.startsWith("vbscript:")||i.startsWith("data:")||i.startsWith("file:")||t.startsWith("//"))){if(t.startsWith("/")||t.startsWith("./")||t.startsWith("../")||t.startsWith("#"))return t;var n=t.toLowerCase();return n.startsWith("http://")||n.startsWith("https://")||n.startsWith("mailto:")||n.startsWith("tel:")?t:void 0}}}}var Ve=20;function qe(e,t,i,n){var r;if(i>Ve)return null;if("text"===e.type&&!G(e.text))return function(e,t,i,n){if(!t||0===t.length)return xe("span",{children:e},n);var r=xe(x,{children:e});for(var o of t)switch(o.type){case"bold":r=xe("strong",{style:{fontWeight:700},children:r});break;case"italic":r=xe("em",{style:{fontStyle:"italic"},children:r});break;case"underline":r=xe("u",{style:{textDecoration:"underline"},children:r});break;case"strike":r=xe("s",{style:{textDecoration:"line-through"},children:r});break;case"code":r=xe("code",{style:i.code,children:r});break;case"link":var s,a=null==(s=o.attrs)?void 0:s.href,l="string"==typeof a?He(a):void 0;l&&(r=xe("a",{href:l,target:"_blank",rel:"noopener noreferrer",referrerPolicy:"no-referrer",style:i.link,children:r}))}return xe("span",{children:r},n)}(e.text,e.marks,t,n);var o=(null==(r=e.content)?void 0:r.map(((e,r)=>qe(e,t,i+1,n+"-"+r))))||[];switch(e.type){case"doc":return xe(x,{children:o});case"paragraph":return xe("p",{style:{margin:"0 0 8px 0"},children:o.length>0?o:xe("br",{})},n);case"hardBreak":return xe("br",{},n);case"codeBlock":var s,a=(null==(s=e.content)||null==(s=s[0])?void 0:s.text)||"";return xe("pre",{style:t.codeBlock,children:xe("code",{children:a})},n);case"image":var l,u,d=null==(l=e.attrs)?void 0:l.src,c=null==(u=e.attrs)?void 0:u.alt,h="string"==typeof d?He(d):void 0;return h?xe("img",{src:h,alt:"string"==typeof c?c:"",style:t.image,onError:e=>{e.target.style.display="none"}},n):null;case"bulletList":return xe("ul",{style:{margin:"8px 0",paddingLeft:"24px"},children:o},n);case"orderedList":return xe("ol",{style:{margin:"8px 0",paddingLeft:"24px"},children:o},n);case"listItem":return xe("li",{style:{margin:"4px 0"},children:o},n);case"blockquote":return xe("blockquote",{style:{margin:"8px 0",paddingLeft:"12px",borderLeft:"3px solid #e4e4e7",color:"#71717a"},children:o},n);case"heading":var f,p=null==(f=e.attrs)?void 0:f.level,v=X(p)?p:1;return xe("h"+Math.min(Math.max(v,1),6),{style:{margin:"12px 0 8px 0"},children:o},n);case"horizontalRule":return xe("hr",{style:{margin:"12px 0",border:"none",borderTop:"1px solid #e4e4e7"}},n);default:return o.length>0?xe("span",{children:o},n):null}}function Ye(e){var{richContent:t,content:i,isCustomer:n,primaryColor:r}=e,o=function(e,t){var i=Re(_e++,7);return function(e,t){return!e||e.length!==t.length||t.some((function(t,i){return t!==e[i]}))}(i.__H,t)&&(i.__=e(),i.__H=t,i.__h=e),i.__}((()=>function(e,t){return{code:{fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace',fontSize:"0.9em",padding:"2px 4px",borderRadius:"3px",background:e?"rgba(255, 255, 255, 0.2)":"rgba(0, 0, 0, 0.06)"},codeBlock:{fontFamily:'ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace',fontSize:"0.85em",padding:"8px 10px",borderRadius:"6px",background:e?"rgba(255, 255, 255, 0.15)":"#f4f4f5",overflowX:"auto",whiteSpace:"pre-wrap",wordWrap:"break-word",wordBreak:"break-word",margin:"8px 0",display:"block",lineHeight:1.5,border:e?"none":"1px solid #e4e4e7"},link:{color:e?"white":t,textDecoration:"underline"},image:{maxWidth:"100%",borderRadius:"4px",marginTop:"4px",marginBottom:"4px",display:"block"}}}(n,r)),[n,r]);if(t)try{if(function(e){if(!e||"object"!=typeof e)return!1;var t=e;return"doc"===t.type&&(G(t.content)||Y(t.content))}(t)){var s=qe(t,o,0,"root");if(s)return s}}catch(e){}return function(e){if(!e)return xe(x,{});var t=e.split("\n");return xe(x,{children:t.map(((e,i)=>xe(x,{children:[e,i<t.length-1&&xe("br",{})]},i)))})}(i)}var Ge=ne("[ConversationsWidget]");class Xe extends _{constructor(e){var i;super(e),i=this,this.S=null,this.M=null,this.T=()=>{this.setState((e=>({state:"open"===e.state?"closed":"open"})))},this.F=()=>{this.setState({state:"closed"})},this.D=e=>{var t=e.target;this.setState({inputValue:t.value})},this.L=e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),this.A())},this.P=e=>{var t=e.target;this.setState({formName:t.value})},this.W=e=>{var t=e.target;this.setState({formEmail:t.value,formEmailError:null})},this.N=e=>{e.preventDefault();var{formEmail:t,formName:i}=this.state,{config:n,onIdentify:r}=this.props;if(!n.requireEmail||t.trim())if(!t.trim()||this.R(t.trim())){var o={};i.trim()&&(o.name=i.trim()),t.trim()&&(o.email=t.trim()),this.setState({userTraits:o,showIdentificationForm:!1}),r&&r(o)}else this.setState({formEmailError:"Please enter a valid email address"});else this.setState({formEmailError:"Email is required"})},this.A=t((function*(){var{inputValue:e}=i.state,t=e.trim();if(t){var n={id:"temp-"+Date.now(),content:t,author_type:"customer",author_name:"You",created_at:(new Date).toISOString(),is_private:!1};i.setState({messages:[...i.state.messages,n],inputValue:"",isLoading:!0,error:null});try{yield i.props.onSendMessage(t),i.setState({isLoading:!1})}catch(e){Ge.error("Failed to send message",e),i.setState({isLoading:!1,error:e instanceof Error?e.message:"Failed to send message"}),i.setState((e=>({messages:e.messages.filter((e=>e.id!==n.id))})))}}}));var n=e.initialUserTraits||null,r=this.U(e.config,n);this.state={state:e.initialState||"closed",messages:[],inputValue:"",isLoading:!1,error:null,showIdentificationForm:r,formName:(null==n?void 0:n.name)||"",formEmail:(null==n?void 0:n.email)||"",formEmailError:null,userTraits:n,unreadCount:0}}U(e,t){return!!e.requireEmail&&(null==t||!t.email)}componentDidMount(){0===this.state.messages.length&&this.props.config.greetingText&&this.B()}componentDidUpdate(e,t){this.state.messages.length!==t.messages.length&&this.$(),this.state.state!==t.state&&this.props.onStateChange&&this.props.onStateChange(this.state.state),"open"===this.state.state&&"open"!==t.state&&(this.O(),this.$())}B(){var e={id:"greeting",content:this.props.config.greetingText||"Hi! How can we help?",author_type:"AI",author_name:"Support",created_at:(new Date).toISOString(),is_private:!1};this.setState({messages:[e]})}$(){this.S&&this.S.scrollIntoView({behavior:"smooth"})}O(){this.M&&this.M.focus()}R(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}j(e){var t=new Date(e),i=(new Date).getTime()-t.getTime(),n=Math.floor(i/6e4);return n<1?"Just now":n<60?n+"m ago":n<1440?Math.floor(n/60)+"h ago":t.toLocaleDateString()}addMessages(e){this.setState((t=>{var i=new Set(t.messages.map((e=>e.id))),n=e.filter((e=>!i.has(e.id)));return n.length>0?{messages:[...t.messages,...n]}:null}))}show(){this.setState({state:"open"})}hide(){this.setState({state:"closed"})}close(){this.setState({state:"closed"})}getUserTraits(){return this.state.userTraits}setUnreadCount(e){this.setState({unreadCount:e})}H(e){var{config:t}=this.props,{formName:n,formEmail:r,formEmailError:o}=this.state,s=t.identificationFormTitle||"Before we start...",a=t.identificationFormDescription||"Please provide your details so we can help you better.",l=!1!==t.collectName;return xe("div",{style:e.identificationForm,children:[xe("div",{style:e.formTitle,children:s}),xe("div",{style:e.formDescription,children:a}),xe("form",{onSubmit:this.N,children:[l&&xe("div",{style:e.formField,children:[xe("label",{style:e.formLabel,children:["Name ",xe("span",{style:e.formOptional,children:"(optional)"})]}),xe("input",{type:"text",style:e.formInput,value:n,onInput:this.P,placeholder:"Your name",autoComplete:"name"})]}),xe("div",{style:e.formField,children:[xe("label",{style:e.formLabel,children:["Email ",!t.requireEmail&&xe("span",{style:e.formOptional,children:"(optional)"})]}),xe("input",{type:"email",style:i({},e.formInput,o?e.formInputError:{}),value:r,onInput:this.W,placeholder:"you@example.com",autoComplete:"email"}),o&&xe("div",{style:e.formError,children:o})]}),xe("button",{type:"submit",style:e.formSubmitButton,onMouseEnter:e=>{e.currentTarget.style.opacity="0.9"},onMouseLeave:e=>{e.currentTarget.style.opacity="1"},children:"Start Chat"})]})]})}V(e,t,n){var r="customer"===e.author_type,o=i({},t.message,r?t.messageCustomer:t.messageAgent),s=i({},t.messageContent,r?t.messageContentCustomer:t.messageContentAgent);return xe("div",{style:o,children:[!r&&e.author_name&&xe("div",{style:t.messageAuthor,children:e.author_name}),xe("div",{style:s,children:xe(Ye,{richContent:e.rich_content,content:e.content,isCustomer:r,primaryColor:n})}),xe("div",{style:t.messageTime,children:this.j(e.created_at)})]},e.id)}render(){var{config:e}=this.props,{state:t,messages:n,inputValue:r,isLoading:o,error:s,showIdentificationForm:a}=this.state,l=e.color||"#5375ff",u=e.widgetPosition||"bottom_right",d=e.placeholderText||"Type your message...",c=we(l,u);if("closed"===t)return xe(Se,{primaryColor:l,position:u,handleToggleOpen:this.T,unreadCount:this.state.unreadCount});var h=i({},c.window,c.windowOpen);return xe("div",{style:c.widget,children:xe("div",{style:h,children:[xe("div",{style:c.header,children:[xe("div",{style:c.headerTitle,children:xe("span",{children:"Support Chat"})}),xe("div",{style:c.headerActions,children:xe(Ee,{primaryColor:l,handleClose:this.F})})]}),a?this.H(c):xe(x,{children:[xe("div",{style:c.messages,children:[n.map((e=>this.V(e,c,l))),xe("div",{ref:e=>{this.S=e}})]}),s&&xe("div",{style:c.error,children:s}),xe("div",{style:c.inputContainer,children:[xe("textarea",{ref:e=>{this.M=e},style:c.input,placeholder:d,value:r,onInput:this.D,onKeyPress:this.L,rows:1,disabled:o}),xe(Me,{primaryColor:l,inputValue:r,isLoading:o,handleSendMessage:this.A})]})]})]})})}}var Ke={};function Ze(e,t,i){if(!(e=>G(e)||(e=>null===e)(e))(e)){if(Y(e))return function(e,t,i){if(Y(e))if(J&&e.forEach===J)e.forEach(t,i);else if("length"in e&&e.length===+e.length)for(var n=0,r=e.length;n<r;n++)if(n in e&&t.call(i,e[n],n)===Ke)return}(e,t,i);if((e=>e instanceof FormData)(e)){for(var n of e.entries())if(t.call(i,n[1],n[0])===Ke)return}else for(var r in e)if(V.call(e,r)&&t.call(i,e[r],r)===Ke)return}}var Je=function(e,t){var i,n;void 0===t&&(t="&");var r=[];return Ze(e,(function(e,t){G(e)||G(t)||"undefined"===t||(i=encodeURIComponent((e=>e instanceof File)(e)?e.name:e.toString()),n=encodeURIComponent(t),r[r.length]=n+"="+i)})),r.join(t)},Qe=ne("[ConversationsManager]"),et="ph-conversations-widget-container";class tt{constructor(e,i){var n=this;this.q=null,this.Y=null,this.G=null,this.X=null,this.K=null,this.Z=!1,this.J=null,this.ee=0,this.te=!1,this.ie=e=>{this.ne.saveUserTraits(e),this._posthog.capture("$conversations_user_identified",{hasName:!!e.name,hasEmail:!!e.email})},this.A=function(){var e=t((function*(e){var t,i=(null==(t=n.q)?void 0:t.getUserTraits())||void 0;try{yield n.sendMessage(e,i),setTimeout((()=>n.re()),1e3)}catch(e){throw Qe.error("Failed to send message",e),e}}));return function(t){return e.apply(this,arguments)}}(),this.oe=e=>{Qe.info("Widget state changed",{state:e}),this._posthog.capture("$conversations_widget_state_changed",{state:e,ticketId:this.G}),this.ne.saveWidgetState(e),"open"===e&&this.ee>0&&this.G&&this.se()},this.re=t((function*(){if(!n.Z&&n.G){n.Z=!0;try{yield n.ae()}finally{n.Z=!1}}})),this._posthog=i,this.le=e,this.ne=new me(i),this.ue=this.ne.getOrCreateWidgetSessionId(),this.de=!0===e.widgetEnabled,this.ce=function(e){var t;if(!e||0===e.length)return!0;var i=null==K||null==(t=K.location)?void 0:t.hostname;return!i||e.some((e=>{var t=function(e){var t=e.replace(/^https?:\/\//,"");return(t=t.split("/")[0].split("?")[0].split(":")[0])||null}(e);if(!t)return!1;if(t.startsWith("*.")){var n=t.slice(2);return i.endsWith("."+n)||i===n}return i===t}))}(e.domains),Qe.info("ConversationsManager initialized",{config:e,widgetSessionId:this.ue,isWidgetEnabled:this.de,isDomainAllowed:this.ce}),this.he()}sendMessage(e,i,n){var r=this;return t((function*(){var t=n?null:r.G,o=!t,s=r.le.token;return new Promise(((a,l)=>{var u,d=r._posthog.get_distinct_id(),c=(null==(u=r._posthog.persistence)?void 0:u.props)||{},h=(null==i?void 0:i.name)||c.$name||c.name||null,f=(null==i?void 0:i.email)||c.$email||c.email||null,p={widget_session_id:r.ue,distinct_id:d,message:e.trim(),traits:{name:h,email:f},ticket_id:t};try{var v,g=r._posthog.get_session_id();g&&(p.session_id=g);var m=r._posthog.get_session_replay_url({withTimestamp:!0,timestampLookBack:30}),y=o?null==K||null==(v=K.location)?void 0:v.href:void 0;(m||y)&&(p.session_context={session_replay_url:m||void 0,current_url:y||void 0})}catch(e){Qe.warn("Failed to capture session context",e)}r._posthog._send_request({url:r._posthog.requestRouter.endpointFor("api","/api/conversations/v1/widget/message"),method:"POST",data:p,headers:{"X-Conversations-Token":s},callback:t=>{if(429!==t.statusCode){if(200!==t.statusCode&&201!==t.statusCode){var i,s,u=(null==(i=t.json)?void 0:i.detail)||(null==(s=t.json)?void 0:s.message)||"Failed to send message";return Qe.error("Failed to send message",{status:t.statusCode}),void l(new Error(u))}if(t.json){var d=t.json;o&&d.ticket_id&&(r.G=d.ticket_id,r.ne.saveTicketId(d.ticket_id),Qe.info("New ticket created",{ticketId:d.ticket_id,forced:!0===n})),r._posthog.capture("$conversations_message_sent",{ticketId:d.ticket_id,isNewTicket:o,messageLength:e.length}),r.K=d.created_at,a(d)}else l(new Error("Invalid response from server"))}else l(new Error("Too many requests. Please wait before trying again."))}})}))}))()}fe(e){e&&e!==this.G&&(this.G=e,this.ne.saveTicketId(e),this.K=null)}getMessages(e,i){var n=this;return t((function*(){var t=e||n.G;if(!t)throw new Error("No ticket ID provided and no active conversation");n.fe(e);var r=n.le.token;return new Promise(((e,o)=>{var s={widget_session_id:n.ue,limit:"50"};i&&(s.after=i),n._posthog._send_request({url:n._posthog.requestRouter.endpointFor("api","/api/conversations/v1/widget/messages/"+t+"?"+Je(s)),method:"GET",headers:{"X-Conversations-Token":r},callback:t=>{if(429!==t.statusCode){if(200!==t.statusCode){var i,n,r=(null==(i=t.json)?void 0:i.detail)||(null==(n=t.json)?void 0:n.message)||"Failed to fetch messages";return Qe.error("Failed to fetch messages",{status:t.statusCode}),void o(new Error(r))}if(t.json){var s=t.json;e(s)}else o(new Error("Invalid response from server"))}else o(new Error("Too many requests. Please wait before trying again."))}})}))}))()}markAsRead(e){var i=this;return t((function*(){var t=e||i.G;if(!t)throw new Error("No ticket ID provided and no active conversation");i.fe(e);var n=i.le.token;return Qe.info("Marking messages as read",{ticketId:t}),new Promise(((e,r)=>{i._posthog._send_request({url:i._posthog.requestRouter.endpointFor("api","/api/conversations/v1/widget/messages/"+t+"/read"),method:"POST",data:{widget_session_id:i.ue},headers:{"X-Conversations-Token":n},callback:t=>{if(429!==t.statusCode){if(200!==t.statusCode){var i,n,o=(null==(i=t.json)?void 0:i.detail)||(null==(n=t.json)?void 0:n.message)||"Failed to mark messages as read";return Qe.error("Failed to mark messages as read",{status:t.statusCode}),void r(new Error(o))}if(t.json){var s=t.json;e(s)}else r(new Error("Invalid response from server"))}else r(new Error("Too many requests. Please wait before trying again."))}})}))}))()}he(){ee&&K?(this.G=this.ne.loadTicketId(),Qe.info("Loaded ticket ID from storage",{ticketId:this.G}),this._posthog.capture("$conversations_loaded",{hasExistingTicket:!!this.G,widgetEnabled:this.de,domainAllowed:this.ce}),this.de&&this.ce?this.pe():Qe.info("Widget not rendered",{widgetEnabled:this.de,domainAllowed:this.ce}),this.ve()):Qe.info("Conversations not available: Document or window not available")}pe(){if(!this.te){var e="closed";"open"===this.ne.loadWidgetState()&&(e="open");var t=this.ge();this.me(e,t),this.te=!0,this._posthog.capture("$conversations_widget_loaded",{hasExistingTicket:!!this.G,initialState:e,hasUserTraits:!!t}),this.G&&this.ae(),this.ye()}}ge(){var e,t=(null==(e=this._posthog.persistence)?void 0:e.props)||{},i=t.$name||t.name,n=t.$email||t.email;if(i||n)return{name:i||void 0,email:n||void 0};var r=this.ne.loadUserTraits();return r&&(r.name||r.email)?r:null}se(){var e=this;return t((function*(){if(e.G)try{var t,i=yield e.markAsRead(e.G||void 0);e.ee=i.unread_count,null==(t=e.q)||t.setUnreadCount(0),Qe.info("Messages marked as read",{unreadCount:i.unread_count})}catch(e){Qe.error("Failed to mark messages as read",e)}}))()}ae(){var e=this;return t((function*(){if(e.G)try{var t,i=yield e.getMessages(e.G||void 0,e.K||void 0);if(X(i.unread_count))e.ee=i.unread_count,null==(t=e.q)||t.setUnreadCount(i.unread_count),i.unread_count>0&&e.we()&&e.se();if(i.messages.length>0){var n;null==(n=e.q)||n.addMessages(i.messages);var r=i.messages[i.messages.length-1];e.K=r.created_at}}catch(e){Qe.error("Failed to load messages",e)}}))()}we(){return"open"===this.ne.loadWidgetState()}ye(){this.X||(this.re(),this.X=null==K?void 0:K.setInterval((()=>{this.re()}),5e3),Qe.info("Started polling for messages"))}be(){this.X&&(null==K||K.clearInterval(this.X),this.X=null,Qe.info("Stopped polling for messages"))}ve(){this.J=this._posthog.on("eventCaptured",(e=>{if("$identify"===e.event){var t,i,n=null==(t=e.properties)?void 0:t.distinct_id,r=null==(i=e.properties)?void 0:i.$anon_distinct_id;r&&n&&r!==n&&(Qe.info("Detected identify event",{oldDistinctId:r,newDistinctId:n}),this.xe(r,n))}}))}xe(e,t){Qe.info("User identified, conversation continues with same widget_session_id",{ticketId:this.G,widgetSessionId:this.ue,oldDistinctId:e,newDistinctId:t}),this._posthog.capture("$conversations_identity_changed",{hadExistingTicket:!!this.G})}show(){this.ce?this.te||this.pe():Qe.warn("Cannot show widget: current domain is not allowed")}hide(){this.be(),this.Y&&(O(null,this.Y),this.Y.remove(),this.Y=null),this.q=null,this.te=!1,this.K=null}isVisible(){return this.te}getTickets(e){var i=this;return t((function*(){var t,n,r=i.le.token,o={widget_session_id:i.ue,limit:String(null!==(t=null==e?void 0:e.limit)&&void 0!==t?t:20),offset:String(null!==(n=null==e?void 0:e.offset)&&void 0!==n?n:0)};return null!=e&&e.status&&(o.status=e.status),new Promise(((e,t)=>{i._posthog._send_request({url:i._posthog.requestRouter.endpointFor("api","/api/conversations/v1/widget/tickets?"+Je(o)),method:"GET",headers:{"X-Conversations-Token":r},callback:i=>{if(429!==i.statusCode){if(200!==i.statusCode){var n,r,o=(null==(n=i.json)?void 0:n.detail)||(null==(r=i.json)?void 0:r.message)||"Failed to fetch tickets";return Qe.error("Failed to fetch tickets",{status:i.statusCode}),void t(new Error(o))}if(i.json){var s=i.json;e(s)}else t(new Error("Invalid response from server"))}else t(new Error("Too many requests. Please wait before trying again."))}})}))}))()}getCurrentTicketId(){return this.G}getWidgetSessionId(){return this.ue}destroy(){this.be(),this.J&&(this.J(),this.J=null),this.Y&&(O(null,this.Y),this.Y.remove(),this.Y=null),this.q=null,Qe.info("Widget destroyed")}reset(){this.ne.clearAll(),this.G=null,this.K=null,this.ee=0,this.destroy(),Qe.info("Conversations reset")}me(e,t){if(ee){var i=ee.getElementById(et);if(!i){if(!ee.body)return void Qe.info("Conversations widget not rendered: Document body not available yet");(i=ee.createElement("div")).id=et,ee.body.appendChild(i)}this.Y=i,O(xe(Xe,{ref:e=>{this.q=e},config:this.le,initialState:e,initialUserTraits:t,onSendMessage:this.A,onStateChange:this.oe,onIdentify:this.ie}),i)}else Qe.info("Conversations widget not rendered: Document not available")}}function it(e,t){return Qe.info("initConversations called",{hasConfig:!!e,hasPosthog:!!t}),new tt(e,t)}te.__PosthogExtensions__=te.__PosthogExtensions__||{},te.__PosthogExtensions__.initConversations=it}();
//# sourceMappingURL=conversations.js.map
